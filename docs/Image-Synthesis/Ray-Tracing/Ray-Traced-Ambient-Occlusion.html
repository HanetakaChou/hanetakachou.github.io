<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
</head>

<body class="markdown-body">
    <h1 dir="auto" id="rtao-ray-traced-ambient-occlusion">RTAO (Ray Traced Ambient Occlusion)</h1>
    <p dir="auto">By &quot;Equation (11.8)&quot; of <a href="https://www.realtimerendering.com/">Real-Time Rendering
            Fourth Edition</a>, the ambient occlusion can be calculated as <eq><span class="katex"><span
                    class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mi mathvariant="normal">
                                        <msub>
                                            <mi mathvariant="normal">k</mi>
                                            <mi mathvariant="normal">A</mi>
                                        </msub>
                                    </mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                    <mo>=</mo>
                                    <msub>
                                        <mo>∫</mo>
                                        <mrow>
                                            <mi mathvariant="normal">
                                                <msup>
                                                    <mi mathvariant="normal">H</mi>
                                                    <mn>2</mn>
                                                </msup>
                                            </mi>
                                            <mo>⁡</mo>
                                            <mo stretchy="false">(</mo>
                                            <mover accent="true">
                                                <mi>n</mi>
                                                <mo stretchy="true">→</mo>
                                            </mover>
                                            <mo stretchy="false">)</mo>
                                        </mrow>
                                    </msub>
                                    <mi mathvariant="normal">V</mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo separator="true">,</mo>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>π</mi>
                                    </mfrac>
                                    <mo stretchy="false">(</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <msub>
                                        <mi>θ</mi>
                                        <mi>i</mi>
                                    </msub>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mo>+</mo>
                                    </msup>
                                    <mtext> </mtext>
                                    <mi>d</mi>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle
                                \operatorname{k_A}(\overrightarrow{p}) = \int_{\operatorname{H^2}(\overrightarrow{n})}
                                \operatorname{V}(\overrightarrow{p}, \overrightarrow{\omega_i}) \frac{1}{\pi} (\cos
                                \theta_i)^+ \, d \overrightarrow{\omega_i}</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:1.20256em;vertical-align:-0.25em;"></span><span class="mop"><span
                                class="mord"><span class="mord mathrm">k</span><span class="msupsub"><span
                                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.32833099999999993em;"><span
                                                    style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                                        class="pstrut" style="height:2.7em;"></span><span
                                                        class="sizing reset-size6 size3 mtight"><span
                                                            class="mord mathrm mtight">A</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mclose">)</span><span class="mspace"
                            style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                            class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
                        class="base"><span class="strut"
                            style="height:2.44695em;vertical-align:-1.0869499999999999em;"></span><span
                            class="mop"><span class="mop op-symbol large-op"
                                style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:-0.24515799999999976em;"><span
                                                style="top:-1.7880500000000004em;margin-left:-0.44445em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mtight"><span class="mop mtight"><span
                                                                class="mord mtight"><span
                                                                    class="mord mathrm mtight">H</span><span
                                                                    class="msupsub"><span class="vlist-t"><span
                                                                            class="vlist-r"><span class="vlist"
                                                                                style="height:0.7463142857142857em;"><span
                                                                                    style="top:-2.786em;margin-right:0.07142857142857144em;"><span
                                                                                        class="pstrut"
                                                                                        style="height:2.5em;"></span><span
                                                                                        class="sizing reset-size3 size1 mtight"><span
                                                                                            class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span
                                                            class="mopen mtight">(</span><span
                                                            class="mord accent mtight"><span class="vlist-t"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.9525600000000001em;"><span
                                                                            style="top:-2.7em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="mord mathnormal mtight">n</span></span><span
                                                                            class="svg-align"
                                                                            style="top:-3.13056em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="hide-tail mtight"
                                                                                style="height:0.522em;min-width:0.888em;"><svg
                                                                                    width='400em' height='0.522em'
                                                                                    viewBox='0 0 400000 522'
                                                                                    preserveAspectRatio='xMaxYMin slice'>
                                                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                                                </svg></span></span></span></span></span></span><span
                                                            class="mclose mtight">)</span></span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:1.0869499999999999em;"><span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span
                                class="mord mathrm" style="margin-right:0.01389em;">V</span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mpunct">,</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span
                                class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.03588em;">π</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span
                            class="mop">cos</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.31166399999999994em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                            class="mclose"><span class="mclose">)</span><span class="msupsub"><span
                                    class="vlist-t"><span class="vlist-r"><span class="vlist"
                                            style="height:0.821331em;"><span
                                                style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                                                    style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mbin mtight">+</span></span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                            class="mord mathnormal">d</span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span></span></span></span>
        </eq> where <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mi mathvariant="normal">V</mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo separator="true">,</mo>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \operatorname{V} (\overrightarrow{p},
                                \overrightarrow{\omega_i})</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:1.20256em;vertical-align:-0.25em;"></span><span class="mop"><span
                                class="mord mathrm" style="margin-right:0.01389em;">V</span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mpunct">,</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mclose">)</span></span></span></span></eq> is the visibility function and <eq><span
                class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>π</mi>
                                    </mfrac>
                                    <mo stretchy="false">(</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <msub>
                                        <mi>θ</mi>
                                        <mi>i</mi>
                                    </msub>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mo>+</mo>
                                    </msup>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \frac{1}{\pi} (\cos \theta_i)^+
                            </annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.03588em;">π</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span
                            class="mop">cos</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.31166399999999994em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                            class="mclose"><span class="mclose">)</span><span class="msupsub"><span
                                    class="vlist-t"><span class="vlist-r"><span class="vlist"
                                            style="height:0.821331em;"><span
                                                style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                                                    style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>
        </eq> is the normalized clamped cosine.</p>
    <h2 dir="auto" id="1-monte-carlo-integration">1. Monte Carlo Integration</h2>
    <p dir="auto">By <a href="https://github.com/mmp/pbrt-v3/blob/master/src/integrators/ao.cpp">AOIntegrator::Li</a> in
        PBRT-V3 and <a
            href="https://github.com/mmp/pbrt-v4/blob/ci/src/pbrt/cpu/integrators.cpp#L1414">AOIntegrator::Li</a> in
        PBRT-V4, the Monte Carlo method can be used to integrate the ambient occlusion.</p>
    <h3 dir="auto" id="1-1-pdf">1-1. PDF</h3>
    <p dir="auto">Since <eq><span class="katex"><span class="katex-mathml"><math
                        xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <msub>
                                        <mo>∫</mo>
                                        <mrow>
                                            <mi mathvariant="normal">
                                                <msup>
                                                    <mi mathvariant="normal">H</mi>
                                                    <mn>2</mn>
                                                </msup>
                                            </mi>
                                            <mo>⁡</mo>
                                            <mo stretchy="false">(</mo>
                                            <mover accent="true">
                                                <mi>n</mi>
                                                <mo stretchy="true">→</mo>
                                            </mover>
                                            <mo stretchy="false">)</mo>
                                        </mrow>
                                    </msub>
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>π</mi>
                                    </mfrac>
                                    <mo stretchy="false">(</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <msub>
                                        <mi>θ</mi>
                                        <mi>i</mi>
                                    </msub>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mo>+</mo>
                                    </msup>
                                    <mtext> </mtext>
                                    <mi>d</mi>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo>=</mo>
                                    <mn>1</mn>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle
                                \int_{\operatorname{H^2}(\overrightarrow{n})} \frac{1}{\pi} (\cos \theta_i)^+ \, d
                                \overrightarrow{\omega_i} = 1</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:2.44695em;vertical-align:-1.0869499999999999em;"></span><span
                            class="mop"><span class="mop op-symbol large-op"
                                style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:-0.24515799999999976em;"><span
                                                style="top:-1.7880500000000004em;margin-left:-0.44445em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mtight"><span class="mop mtight"><span
                                                                class="mord mtight"><span
                                                                    class="mord mathrm mtight">H</span><span
                                                                    class="msupsub"><span class="vlist-t"><span
                                                                            class="vlist-r"><span class="vlist"
                                                                                style="height:0.7463142857142857em;"><span
                                                                                    style="top:-2.786em;margin-right:0.07142857142857144em;"><span
                                                                                        class="pstrut"
                                                                                        style="height:2.5em;"></span><span
                                                                                        class="sizing reset-size3 size1 mtight"><span
                                                                                            class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span
                                                            class="mopen mtight">(</span><span
                                                            class="mord accent mtight"><span class="vlist-t"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.9525600000000001em;"><span
                                                                            style="top:-2.7em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="mord mathnormal mtight">n</span></span><span
                                                                            class="svg-align"
                                                                            style="top:-3.13056em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="hide-tail mtight"
                                                                                style="height:0.522em;min-width:0.888em;"><svg
                                                                                    width='400em' height='0.522em'
                                                                                    viewBox='0 0 400000 522'
                                                                                    preserveAspectRatio='xMaxYMin slice'>
                                                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                                                </svg></span></span></span></span></span></span><span
                                                            class="mclose mtight">)</span></span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:1.0869499999999999em;"><span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.03588em;">π</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span
                            class="mop">cos</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.31166399999999994em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                            class="mclose"><span class="mclose">)</span><span class="msupsub"><span
                                    class="vlist-t"><span class="vlist-r"><span class="vlist"
                                            style="height:0.821331em;"><span
                                                style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                                                    style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mbin mtight">+</span></span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                            class="mord mathnormal">d</span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                            class="mrel">=</span><span class="mspace"
                            style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                            class="strut" style="height:0.64444em;vertical-align:0em;"></span><span
                            class="mord">1</span></span></span></span></eq>, the normalized clamped cosine <eq><span
                class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>π</mi>
                                    </mfrac>
                                    <mo stretchy="false">(</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <msub>
                                        <mi>θ</mi>
                                        <mi>i</mi>
                                    </msub>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mo>+</mo>
                                    </msup>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \frac{1}{\pi} (\cos \theta_i)^+
                            </annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.03588em;">π</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span
                            class="mop">cos</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.31166399999999994em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                            class="mclose"><span class="mclose">)</span><span class="msupsub"><span
                                    class="vlist-t"><span class="vlist-r"><span class="vlist"
                                            style="height:0.821331em;"><span
                                                style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                                                    style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span>
        </eq> can be used as the PDF.</p>
    <h3 dir="auto" id="1-2-estimator">1-2. Estimator</h3>
    <p dir="auto">By &quot;Equation (13.3)&quot; of <a
            href="https://pbr-book.org/3ed-2018/Monte_Carlo_Integration/The_Monte_Carlo_Estimator">PBR Book V3</a> and
        &quot;Equation (2.7)&quot; of <a
            href="https://www.pbr-book.org/4ed/Monte_Carlo_Integration/Monte_Carlo_Basics#TheMonteCarloEstimator">PBR
            Book V4</a>, we have the Monte Carlo estimator <eq><span class="katex"><span class="katex-mathml"><math
                        xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mi mathvariant="normal">
                                        <msub>
                                            <mi mathvariant="normal">k</mi>
                                            <mi mathvariant="normal">A</mi>
                                        </msub>
                                    </mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                    <mo>=</mo>
                                    <msub>
                                        <mo>∫</mo>
                                        <mrow>
                                            <mi mathvariant="normal">
                                                <msup>
                                                    <mi mathvariant="normal">H</mi>
                                                    <mn>2</mn>
                                                </msup>
                                            </mi>
                                            <mo>⁡</mo>
                                            <mo stretchy="false">(</mo>
                                            <mover accent="true">
                                                <mi>n</mi>
                                                <mo stretchy="true">→</mo>
                                            </mover>
                                            <mo stretchy="false">)</mo>
                                        </mrow>
                                    </msub>
                                    <mi mathvariant="normal">V</mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo separator="true">,</mo>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>π</mi>
                                    </mfrac>
                                    <mo stretchy="false">(</mo>
                                    <mi>cos</mi>
                                    <mo>⁡</mo>
                                    <msub>
                                        <mi>θ</mi>
                                        <mi>i</mi>
                                    </msub>
                                    <msup>
                                        <mo stretchy="false">)</mo>
                                        <mo>+</mo>
                                    </msup>
                                    <mtext> </mtext>
                                    <mi>d</mi>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo>=</mo>
                                    <mo>∑</mo>
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>N</mi>
                                    </mfrac>
                                    <mfrac>
                                        <mrow>
                                            <mi mathvariant="normal">V</mi>
                                            <mo>⁡</mo>
                                            <mo stretchy="false">(</mo>
                                            <mover accent="true">
                                                <mi>p</mi>
                                                <mo stretchy="true">→</mo>
                                            </mover>
                                            <mo separator="true">,</mo>
                                            <mover accent="true">
                                                <msub>
                                                    <mi>ω</mi>
                                                    <mi>i</mi>
                                                </msub>
                                                <mo stretchy="true">→</mo>
                                            </mover>
                                            <mo stretchy="false">)</mo>
                                            <mfrac>
                                                <mn>1</mn>
                                                <mi>π</mi>
                                            </mfrac>
                                            <mo stretchy="false">(</mo>
                                            <mi>cos</mi>
                                            <mo>⁡</mo>
                                            <msub>
                                                <mi>θ</mi>
                                                <mi>i</mi>
                                            </msub>
                                            <msup>
                                                <mo stretchy="false">)</mo>
                                                <mo>+</mo>
                                            </msup>
                                        </mrow>
                                        <mrow>
                                            <mfrac>
                                                <mn>1</mn>
                                                <mi>π</mi>
                                            </mfrac>
                                            <mo stretchy="false">(</mo>
                                            <mi>cos</mi>
                                            <mo>⁡</mo>
                                            <msub>
                                                <mi>θ</mi>
                                                <mi>i</mi>
                                            </msub>
                                            <msup>
                                                <mo stretchy="false">)</mo>
                                                <mo>+</mo>
                                            </msup>
                                        </mrow>
                                    </mfrac>
                                    <mo>=</mo>
                                    <mo>∑</mo>
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>N</mi>
                                    </mfrac>
                                    <mi mathvariant="normal">V</mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo separator="true">,</mo>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle
                                \operatorname{k_A}(\overrightarrow{p}) = \int_{\operatorname{H^2}(\overrightarrow{n})}
                                \operatorname{V}(\overrightarrow{p}, \overrightarrow{\omega_i}) \frac{1}{\pi} (\cos
                                \theta_i)^+ \, d \overrightarrow{\omega_i} = \sum \frac{1}{N}
                                \frac{\operatorname{V}(\overrightarrow{p}, \overrightarrow{\omega_i}) \frac{1}{\pi}
                                (\cos \theta_i)^+}{\frac{1}{\pi} (\cos \theta_i)^+} = \sum \frac{1}{N}
                                \operatorname{V}(\overrightarrow{p}, \overrightarrow{\omega_i})</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:1.20256em;vertical-align:-0.25em;"></span><span class="mop"><span
                                class="mord"><span class="mord mathrm">k</span><span class="msupsub"><span
                                        class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                style="height:0.32833099999999993em;"><span
                                                    style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span
                                                        class="pstrut" style="height:2.7em;"></span><span
                                                        class="sizing reset-size6 size3 mtight"><span
                                                            class="mord mathrm mtight">A</span></span></span></span><span
                                                class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mclose">)</span><span class="mspace"
                            style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                            class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
                        class="base"><span class="strut"
                            style="height:2.44695em;vertical-align:-1.0869499999999999em;"></span><span
                            class="mop"><span class="mop op-symbol large-op"
                                style="margin-right:0.44445em;position:relative;top:-0.0011249999999999316em;">∫</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:-0.24515799999999976em;"><span
                                                style="top:-1.7880500000000004em;margin-left:-0.44445em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mtight"><span class="mop mtight"><span
                                                                class="mord mtight"><span
                                                                    class="mord mathrm mtight">H</span><span
                                                                    class="msupsub"><span class="vlist-t"><span
                                                                            class="vlist-r"><span class="vlist"
                                                                                style="height:0.7463142857142857em;"><span
                                                                                    style="top:-2.786em;margin-right:0.07142857142857144em;"><span
                                                                                        class="pstrut"
                                                                                        style="height:2.5em;"></span><span
                                                                                        class="sizing reset-size3 size1 mtight"><span
                                                                                            class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span
                                                            class="mopen mtight">(</span><span
                                                            class="mord accent mtight"><span class="vlist-t"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.9525600000000001em;"><span
                                                                            style="top:-2.7em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="mord mathnormal mtight">n</span></span><span
                                                                            class="svg-align"
                                                                            style="top:-3.13056em;"><span class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="hide-tail mtight"
                                                                                style="height:0.522em;min-width:0.888em;"><svg
                                                                                    width='400em' height='0.522em'
                                                                                    viewBox='0 0 400000 522'
                                                                                    preserveAspectRatio='xMaxYMin slice'>
                                                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                                                </svg></span></span></span></span></span></span><span
                                                            class="mclose mtight">)</span></span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:1.0869499999999999em;"><span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span
                                class="mord mathrm" style="margin-right:0.01389em;">V</span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mpunct">,</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span
                                class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.03588em;">π</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span
                            class="mop">cos</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.31166399999999994em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span><span
                            class="mclose"><span class="mclose">)</span><span class="msupsub"><span
                                    class="vlist-t"><span class="vlist-r"><span class="vlist"
                                            style="height:0.821331em;"><span
                                                style="top:-3.113em;margin-right:0.05em;"><span class="pstrut"
                                                    style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mbin mtight">+</span></span></span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.16666666666666666em;"></span><span
                            class="mord mathnormal">d</span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mspace" style="margin-right:0.2777777777777778em;"></span><span
                            class="mrel">=</span><span class="mspace"
                            style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span
                            class="strut" style="height:2.767668em;vertical-align:-1.080108em;"></span><span
                            class="mop op-symbol large-op"
                            style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.10903em;">N</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.68756em;"><span style="top:-2.2648919999999997em;"><span
                                                    class="pstrut" style="height:3em;"></span><span class="mord"><span
                                                        class="mord"><span class="mopen nulldelimiter"></span><span
                                                            class="mfrac"><span class="vlist-t vlist-t2"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.845108em;"><span
                                                                            style="top:-2.6550000000000002em;"><span
                                                                                class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mtight"><span
                                                                                        class="mord mathnormal mtight"
                                                                                        style="margin-right:0.03588em;">π</span></span></span></span><span
                                                                            style="top:-3.23em;"><span class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="frac-line"
                                                                                style="border-bottom-width:0.04em;"></span></span><span
                                                                            style="top:-3.394em;"><span class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mtight"><span
                                                                                        class="mord mtight">1</span></span></span></span></span><span
                                                                        class="vlist-s">​</span></span><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.345em;"><span></span></span></span></span></span><span
                                                            class="mclose nulldelimiter"></span></span><span
                                                        class="mopen">(</span><span class="mop">cos</span><span
                                                        class="mspace"
                                                        style="margin-right:0.16666666666666666em;"></span><span
                                                        class="mord"><span class="mord mathnormal"
                                                            style="margin-right:0.02778em;">θ</span><span
                                                            class="msupsub"><span class="vlist-t vlist-t2"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.31166399999999994em;"><span
                                                                            style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                                                class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mathnormal mtight">i</span></span></span></span><span
                                                                        class="vlist-s">​</span></span><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                                                        class="mclose"><span class="mclose">)</span><span
                                                            class="msupsub"><span class="vlist-t"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.697331em;"><span
                                                                            style="top:-2.989em;margin-right:0.05em;"><span
                                                                                class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.7350000000000003em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mop"><span class="mord mathrm"
                                                            style="margin-right:0.01389em;">V</span></span><span
                                                        class="mopen">(</span><span class="mord accent"><span
                                                            class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                    class="vlist"
                                                                    style="height:0.9525600000000001em;"><span
                                                                        style="top:-3em;"><span class="pstrut"
                                                                            style="height:3em;"></span><span
                                                                            class="mord mathnormal">p</span></span><span
                                                                        class="svg-align" style="top:-3.43056em;"><span
                                                                            class="pstrut"
                                                                            style="height:3em;"></span><span
                                                                            class="hide-tail"
                                                                            style="height:0.522em;min-width:0.888em;"><svg
                                                                                width='400em' height='0.522em'
                                                                                viewBox='0 0 400000 522'
                                                                                preserveAspectRatio='xMaxYMin slice'>
                                                                                <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                                            </svg></span></span></span><span
                                                                    class="vlist-s">​</span></span><span
                                                                class="vlist-r"><span class="vlist"
                                                                    style="height:0.19444em;"><span></span></span></span></span></span><span
                                                        class="mpunct">,</span><span class="mspace"
                                                        style="margin-right:0.16666666666666666em;"></span><span
                                                        class="mord accent"><span class="vlist-t vlist-t2"><span
                                                                class="vlist-r"><span class="vlist"
                                                                    style="height:0.95256em;"><span
                                                                        style="top:-3em;"><span class="pstrut"
                                                                            style="height:3em;"></span><span
                                                                            class="mord"><span class="mord mathnormal"
                                                                                style="margin-right:0.03588em;">ω</span><span
                                                                                class="msupsub"><span
                                                                                    class="vlist-t vlist-t2"><span
                                                                                        class="vlist-r"><span
                                                                                            class="vlist"
                                                                                            style="height:0.31166399999999994em;"><span
                                                                                                style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                                                    class="pstrut"
                                                                                                    style="height:2.7em;"></span><span
                                                                                                    class="sizing reset-size6 size3 mtight"><span
                                                                                                        class="mord mathnormal mtight">i</span></span></span></span><span
                                                                                            class="vlist-s">​</span></span><span
                                                                                        class="vlist-r"><span
                                                                                            class="vlist"
                                                                                            style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                                                        class="svg-align" style="top:-3.43056em;"><span
                                                                            class="pstrut"
                                                                            style="height:3em;"></span><span
                                                                            class="hide-tail"
                                                                            style="height:0.522em;min-width:0.888em;"><svg
                                                                                width='400em' height='0.522em'
                                                                                viewBox='0 0 400000 522'
                                                                                preserveAspectRatio='xMaxYMin slice'>
                                                                                <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                                            </svg></span></span></span><span
                                                                    class="vlist-s">​</span></span><span
                                                                class="vlist-r"><span class="vlist"
                                                                    style="height:0.15em;"><span></span></span></span></span></span><span
                                                        class="mclose">)</span><span class="mord"><span
                                                            class="mopen nulldelimiter"></span><span class="mfrac"><span
                                                                class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                        class="vlist" style="height:0.845108em;"><span
                                                                            style="top:-2.6550000000000002em;"><span
                                                                                class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mtight"><span
                                                                                        class="mord mathnormal mtight"
                                                                                        style="margin-right:0.03588em;">π</span></span></span></span><span
                                                                            style="top:-3.23em;"><span class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="frac-line"
                                                                                style="border-bottom-width:0.04em;"></span></span><span
                                                                            style="top:-3.394em;"><span class="pstrut"
                                                                                style="height:3em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mtight"><span
                                                                                        class="mord mtight">1</span></span></span></span></span><span
                                                                        class="vlist-s">​</span></span><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.345em;"><span></span></span></span></span></span><span
                                                            class="mclose nulldelimiter"></span></span><span
                                                        class="mopen">(</span><span class="mop">cos</span><span
                                                        class="mspace"
                                                        style="margin-right:0.16666666666666666em;"></span><span
                                                        class="mord"><span class="mord mathnormal"
                                                            style="margin-right:0.02778em;">θ</span><span
                                                            class="msupsub"><span class="vlist-t vlist-t2"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.31166399999999994em;"><span
                                                                            style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span
                                                                                class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mord mathnormal mtight">i</span></span></span></span><span
                                                                        class="vlist-s">​</span></span><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.15em;"><span></span></span></span></span></span></span><span
                                                        class="mclose"><span class="mclose">)</span><span
                                                            class="msupsub"><span class="vlist-t"><span
                                                                    class="vlist-r"><span class="vlist"
                                                                        style="height:0.771331em;"><span
                                                                            style="top:-3.063em;margin-right:0.05em;"><span
                                                                                class="pstrut"
                                                                                style="height:2.7em;"></span><span
                                                                                class="sizing reset-size6 size3 mtight"><span
                                                                                    class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:1.080108em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mspace"
                            style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                            class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
                        class="base"><span class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span
                            class="mop op-symbol large-op"
                            style="position:relative;top:-0.000004999999999977245em;">∑</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal"
                                                        style="margin-right:0.10903em;">N</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mop"><span
                                class="mord mathrm" style="margin-right:0.01389em;">V</span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mpunct">,</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mclose">)</span></span></span></span></eq>.</p>
    <h3 dir="auto" id="1-3-sampling-normalized-clamped-cosine">1-3. Sampling Normalized Clamped Cosine</h3>
    <p dir="auto">By &quot;13.6.3 Cosine-Weighted Hemisphere Sampling&quot; of <a
            href="https://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations#Cosine-WeightedHemisphereSampling">PBR
            Book V3</a> and &quot;A.5.3 Cosine-Weighted Hemisphere Sampling&quot; of <a
            href="https://www.pbr-book.org/4ed/Sampling_Algorithms/Sampling_Multidimensional_Functions#Cosine-WeightedHemisphereSampling">PBR
            Book V4</a>, we can efficiently sample the normalized clamped cosine.</p>
    <p dir="auto">The normalized clamped cosine sampling is calculated by <a
            href="https://github.com/EpicGames/UnrealEngine/blob/4.27/Engine/Shaders/Private/MonteCarlo.ush#L241">CosineSampleHemisphere</a>
        in UE4 and <a
            href="https://github.com/Unity-Technologies/Graphics/blob/v10.8.1/com.unity.render-pipelines.core/ShaderLibrary/Sampling/Sampling.hlsl#L157">SampleHemisphereCosine</a>
        in Unity3D.</p>
    <h3 dir="auto" id="1-4-low-discrepancy-sequence">1-4. Low Discrepancy Sequence</h3>
    <p dir="auto">By &quot;20.3 Quasirandom Low-Discrepancy Sequences&quot; of [Colbert 2007], &quot;13.8.2 Quasi Monte
        Carlo&quot; of <a
            href="https://pbr-book.org/3ed-2018/Monte_Carlo_Integration/Careful_Sample_Placement#QuasiMonteCarlo">PBR
            Book V3</a> and &quot;8.2.2 Low Discrepancy and Quasi Monte Carlo&quot; of <a
            href="https://pbr-book.org/4ed/Sampling_and_Reconstruction/Sampling_and_Integration#LowDiscrepancyandQuasiMonteCarlo">PBR
            Book V4</a>, the <strong>low discrepancy sequence</strong> is the better alternative than <strong>pseudo
            random sequence</strong> to generate the <eq><span class="katex"><span class="katex-mathml"><math
                        xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <msub>
                                        <mi>ξ</mi>
                                        <mn>1</mn>
                                    </msub>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \xi_1</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span
                            class="mord"><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.30110799999999993em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.04601em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mtight">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>
        </eq> and <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <msub>
                                        <mi>ξ</mi>
                                        <mn>2</mn>
                                    </msub>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \xi_2</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span
                            class="mord"><span class="mord mathnormal" style="margin-right:0.04601em;">ξ</span><span
                                class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:0.30110799999999993em;"><span
                                                style="top:-2.5500000000000003em;margin-left:-0.04601em;margin-right:0.05em;"><span
                                                    class="pstrut" style="height:2.7em;"></span><span
                                                    class="sizing reset-size6 size3 mtight"><span
                                                        class="mord mtight">2</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>
        </eq>.</p>
    <p dir="auto">By &quot;7.4.1 Hammersley and Halton Sequences&quot; of <a
            href="https://pbr-book.org/3ed-2018/Sampling_and_Reconstruction/The_Halton_Sampler#HammersleyandHaltonSequences">PBR
            Book V3</a> and &quot;8.6.1 Hammersley and Halton Points&quot; of <a
            href="https://pbr-book.org/4ed/Sampling_and_Reconstruction/Halton_Sampler#HammersleyandHaltonPoints">PBR
            Book V4</a>, the <strong>Hammersley sequence</strong> is a typical <strong>low-discrepancy
            sequence</strong>.</p>
    <p dir="auto">The <strong>Hammersley sequence</strong> is calculated by <a
            href="https://github.com/EpicGames/UnrealEngine/blob/4.27/Engine/Shaders/Private/MonteCarlo.ush#L34">Hammersley</a>
        in UE4 and <a
            href="https://github.com/Unity-Technologies/Graphics/blob/v10.8.0/com.unity.render-pipelines.core/ShaderLibrary/Sampling/Hammersley.hlsl#L415">Hammersley2d</a>
        in Unity3D.</p>
    <h2 dir="auto" id="2-ray-tracing">2. Ray Tracing</h2>
    <p dir="auto">The Ray Tracing APIs such as <a
            href="https://microsoft.github.io/DirectX-Specs/d3d/Raytracing.html">DXR (DirectX Raytracing)</a> and <a
            href="https://www.khronos.org/blog/ray-tracing-in-vulkan">Vulkan Ray Tracing</a> can be used to calculate
        the visibility function.</p>
    <h3 dir="auto" id="2-1-max-distance">2-1. Max Distance</h3>
    <p dir="auto">By &quot;11.3.2 Visibility and Obscurance&quot; of <a
            href="https://www.realtimerendering.com/">Real-Time Rendering Fourth Edition</a>, the visibility function
        <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mi mathvariant="normal">V</mi>
                                    <mo>⁡</mo>
                                    <mo stretchy="false">(</mo>
                                    <mover accent="true">
                                        <mi>p</mi>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo separator="true">,</mo>
                                    <mover accent="true">
                                        <msub>
                                            <mi>ω</mi>
                                            <mi>i</mi>
                                        </msub>
                                        <mo stretchy="true">→</mo>
                                    </mover>
                                    <mo stretchy="false">)</mo>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \operatorname{V} (\overrightarrow{p},
                                \overrightarrow{\omega_i})</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:1.20256em;vertical-align:-0.25em;"></span><span class="mop"><span
                                class="mord mathrm" style="margin-right:0.01389em;">V</span></span><span
                            class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span
                                    class="vlist-r"><span class="vlist" style="height:0.9525600000000001em;"><span
                                            style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span
                                                class="mord mathnormal">p</span></span><span class="svg-align"
                                            style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.19444em;"><span></span></span></span></span></span><span
                            class="mpunct">,</span><span class="mspace"
                            style="margin-right:0.16666666666666666em;"></span><span class="mord accent"><span
                                class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                        style="height:0.95256em;"><span style="top:-3em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="mord"><span
                                                    class="mord mathnormal"
                                                    style="margin-right:0.03588em;">ω</span><span class="msupsub"><span
                                                        class="vlist-t vlist-t2"><span class="vlist-r"><span
                                                                class="vlist"
                                                                style="height:0.31166399999999994em;"><span
                                                                    style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span
                                                                        class="pstrut"
                                                                        style="height:2.7em;"></span><span
                                                                        class="sizing reset-size6 size3 mtight"><span
                                                                            class="mord mathnormal mtight">i</span></span></span></span><span
                                                                class="vlist-s">​</span></span><span
                                                            class="vlist-r"><span class="vlist"
                                                                style="height:0.15em;"><span></span></span></span></span></span></span></span><span
                                            class="svg-align" style="top:-3.43056em;"><span class="pstrut"
                                                style="height:3em;"></span><span class="hide-tail"
                                                style="height:0.522em;min-width:0.888em;"><svg width='400em'
                                                    height='0.522em' viewBox='0 0 400000 522'
                                                    preserveAspectRatio='xMaxYMin slice'>
                                                    <path d='M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z' />
                                                </svg></span></span></span><span class="vlist-s">​</span></span><span
                                    class="vlist-r"><span class="vlist"
                                        style="height:0.15em;"><span></span></span></span></span></span><span
                            class="mclose">)</span></span></span></span></eq> is actually the distance mapping function.
        The value of the visibility function is 1 instead of 0, when closest intersection distance is greater than a
        specified max distance.
    </p>
    <h3 dir="auto" id="2-2-self-intersection">2-2. Self Intersection</h3>
    <p dir="auto">By [Wachter 2019], &quot;3.9.5 Robust Spawned Ray Origins&quot; of <a
            href="https://pbr-book.org/3ed-2018/Shapes/Managing_Rounding_Error#RobustSpawnedRayOrigins">PBR Book V3</a>
        and &quot;6.8.6 Robust Spawned Ray Origins&quot; of <a
            href="https://pbr-book.org/4ed/Shapes/Managing_Rounding_Error#RobustSpawnedRayOrigins">PBR Book V4</a>, we
        should offset the ray origin to avoid self intersection.</p>
    <h2 dir="auto" id="references">References</h2>
    <p dir="auto">[Colbert 2007] <a
            href="https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-20-gpu-based-importance-sampling">Mark
            Colbert, Jaroslav Krivanek. &quot;GPU-Based Importance Sampling.&quot; GPU Gems 3.</a><br>
        [Wachter 2019] <a
            href="https://github.com/Apress/ray-tracing-gems/blob/master/Ch_06_A_Fast_and_Robust_Method_for_Avoiding_Self-Intersection/offset_ray.cu">Carsten
            Wachter, Nikolaus Binder. &quot;A Fast and Robust Method for Avoiding Self-Intersection.&quot; Ray Tracing
            Gems.</a></p>

</body>

</html>