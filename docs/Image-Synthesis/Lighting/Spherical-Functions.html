<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
</head>

<body class="markdown-body">
    <h2 dir="auto" id="sh-spherical-harmonics">SH (Spherical Harmonics)</h2>
    <h3 dir="auto" id="polynomial-forms">Polynomial Forms</h3>
    <p dir="auto">As an engineer, we may merely focus on the polynomial forms ([Sloan 2008] / Appendix A2 Polynomial
        Forms of SH Basis).</p>
    <h3 dir="auto" id="projection">Projection</h3>
    <p dir="auto">The pseudo-code is provided by &quot;[Sloan 2008] / Projection from Cube Maps&quot;. According to the
        Equation (5.6) of the <a
            href="https://pbr-book.org/3ed-2018/Color_and_Radiometry/Working_with_Radiometric_Integrals#IntegralsoverArea">PBR
            Book</a>, we can comprehend that the &quot;fWt = 4 / (sqrt(fTmp) * fTmp)&quot; in the pseudo-code is merely
        to calculate the <eq><span class="katex"><span class="katex-mathml"><math
                        xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mi>d</mi>
                                    <mi>ω</mi>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle d\omega</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:0.69444em;vertical-align:0em;"></span><span
                            class="mord mathnormal">d</span><span class="mord mathnormal"
                            style="margin-right:0.03588em;">ω</span></span></span></span></eq> without the common
        divisor &quot;1.0 / cube_size / cube_size&quot;. And here is the MATLAB code which verifies the meaning of
        &quot;fWt&quot;.</p>
    <pre><code class="code-line language-MATLAB" dir="auto"><div><span class="hljs-comment">% retrieved by &quot;textureSize(GLSL)&quot; or &quot;GetDimensions(HLSL)&quot;</span>
cube_size = <span class="hljs-number">4096.0</span>;

[ u, v ] = <span class="hljs-built_in">meshgrid</span>(<span class="hljs-built_in">linspace</span>(<span class="hljs-number">-1.0</span>, <span class="hljs-number">1.0</span>, cube_size), <span class="hljs-built_in">linspace</span>(<span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, cube_size));

<span class="hljs-comment">% Equation (5.6) of the [PBR Book](https://pbr-book.org/3ed-2018/Color_and_Radiometry/Working_with_Radiometric_Integrals#IntegralsoverArea)</span>
<span class="hljs-comment">% &quot;Stupid Spherical Harmonics (SH) Tricks&quot; / &quot;Projection from Cube Maps&quot; / &quot;fWt = 4/(sqrt(fTmp)*fTmp)&quot;</span>
r_2 = <span class="hljs-number">1.0</span> .* <span class="hljs-number">1.0</span> + u .* u + v .* v;
<span class="hljs-comment">% the common divisor &quot;1.0 ./ cube_size ./ cube_size&quot; can be reduced, and thus is NOT calculated in &quot;fWt = 4/(sqrt(fTmp)*fTmp)&quot;</span>
d_a = (<span class="hljs-number">1.0</span> - (<span class="hljs-number">-1.0</span>)) .* (<span class="hljs-number">1.0</span> - (<span class="hljs-number">-1.0</span>)) ./ cube_size ./ cube_size;
cos_theta = <span class="hljs-number">1.0</span> ./ <span class="hljs-built_in">sqrt</span>(r_2);
d_omega = d_a .* cos_theta ./ r_2;

<span class="hljs-comment">% &quot;numerical_omega&quot; and &quot;groundtruth_omega&quot; are expected to be the same</span>
numerical_omega = sum(sum(d_omega));
groundtruth_omega = <span class="hljs-number">4.0</span> .* <span class="hljs-built_in">pi</span> .* <span class="hljs-number">1.0</span> .* <span class="hljs-number">1.0</span> / <span class="hljs-number">6.0</span>;

<span class="hljs-comment">% output: &quot;numerical:2.093936 groundtruth:2.094395&quot;</span>
printf(<span class="hljs-string">&quot;numerical:%f groundtruth:%f\n&quot;</span>, numerical_omega, groundtruth_omega);
</div></code></pre>
    <h2 dir="auto" id="reference">Reference</h2>
    <p dir="auto">[Sloan 2008] <a href="http://www.ppsloan.org/publications/StupidSH36.pdf">Peter-Pike Sloan.
            &quot;Stupid Spherical Harmonics (SH).&quot; Tricks GDC 2008.</a></p>

</body>

</html>