<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
</head>

<body class="markdown-body">
    <h3 dir="auto" id="nh-and-lh-1"><strong>N·H</strong> and <strong>L·H</strong></h3>
    <pre><code class="code-line language-c++" dir="auto"><div><span class="hljs-comment">// Real-Time Rendering Fourth Edition: &quot;Hammon also shows a method to optimize the BRDF implementation by calculating **n·h** and **l·h** without calculating the vector **h** itself.&quot;  </span>
<span class="hljs-comment">// We assume that N, V, L are normalized, and we have the following:  </span>
<span class="hljs-comment">// |L + V|^2 = L^2 + V^2 + 2L·V = 1 + 1 + 2L·V</span>
<span class="hljs-type">float</span> rcpLen_LV = <span class="hljs-built_in">rsqrt</span>(<span class="hljs-number">2.0</span> + <span class="hljs-number">2.0</span> * LdotV);  
<span class="hljs-comment">// N·H = N·((L + V)/(|L + V|)) = (N·L + N·V)/(|L + V|)</span>
<span class="hljs-type">float</span> NdotH = <span class="hljs-built_in">saturate</span>((NdotL + NdotV) * rcpLen_LV);  
<span class="hljs-comment">// L·H = L·((L + V)/(|L + V|)) = (L^2 + L·V)/(|L + V|)</span>
<span class="hljs-comment">// V·H = V·((L + V)/(|L + V|)) = (L·V + V^2)/(|L + V|)</span>
<span class="hljs-comment">// 2L·H = 2V·H = L·H + V·H = (L^2 + L·V + L·V + V^2)/(|L + V|) = (|L + V|^2)/(|L + V|) = |L + V| = 1 + 1 + 2L·V</span>
<span class="hljs-comment">// ⇒ L·H = 0.5 * |L + V| = (0.5 * |L + V|^2)/(|L + V|) =(0.5 * (1 + 1 + 2L·V))/(|L + V|) = 1/(|L + V|) + (L·V)/(|L + V|)</span>
<span class="hljs-type">float</span> LdotH = <span class="hljs-built_in">saturate</span>(rcpLen_LV * LdotV + rcpLen_LV);
</div></code></pre>
    <p dir="auto">The <strong>N·H</strong> and the <strong>L·H</strong> are calculated by <a
            href="https://github.com/Unity-Technologies/Graphics/blob/v10.8.0/com.unity.render-pipelines.core/ShaderLibrary/CommonLighting.hlsl#L361">GetBSDFAngle</a>
        in Unity3D and <a
            href="https://github.com/EpicGames/UnrealEngine/blob/4.27/Engine/Shaders/Private/BRDF.ush#L31">Init</a> in
        UE4.</p>

</body>

</html>