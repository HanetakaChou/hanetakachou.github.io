<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/default.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
</head>

<body class="markdown-body">
    <h1 dir="auto" id="restir-reservoir-based-spatiotemporal-importance-resampling">ReSTIR (Reservoir-Based
        Spatiotemporal Importance Resampling)</h1>
    <h2 dir="auto" id="reservoir-sampling">Reservoir Sampling</h2>
    <h3 dir="auto" id="basic-reservoir-sampling">Basic Reservoir Sampling</h3>
    <p dir="auto">By &quot;A.2 Reservoir Sampling&quot; of <a
            href="https://www.pbr-book.org/4ed/Sampling_Algorithms/Reservoir_Sampling#">PBR Book V4</a>, we have the
        <strong>basic reservoir sampling</strong>.
    </p>
    <p dir="auto">We sequentially process each <strong>sample</strong> from the <strong>stream</strong>. The total
        length of the <strong>stream</strong> can indeed be infinite which is too large to be stored in the memory.</p>
    <p dir="auto">We assume that we have processed <strong>n</strong> <strong>samples</strong>. This means that the
        number of the <strong>seen samples</strong> is <strong>n</strong>. For the <strong>basic reservoir
            sampling</strong>, the <strong>reservoir</strong> can hold at most <strong>1</strong> <strong>reservoir
            sample</strong>, and the first <strong>1</strong> <strong>seen</strong> <strong>sample</strong> is always
        selected to initialize the <strong>reservoir</strong>. For each subsequent <strong>seen</strong>
        <strong>candidate sample</strong>, we decide whether or not it should be selected to replace the existing
        <strong>sample</strong> in the <strong>reservoir</strong> based on the probability <eq><span class="katex"><span
                    class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>n</mi>
                                    </mfrac>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \frac{1}{n}</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal">n</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span></span></span></span></eq>.
    </p>
    <p dir="auto">We can prove by <strong>mathematical Induction</strong> that at any iteration, when we have processed
        n <strong>samples</strong>, each <strong>sample</strong> from the <strong>stream</strong> has an equal
        probability <eq><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                            <mrow>
                                <mstyle scriptlevel="0" displaystyle="true">
                                    <mfrac>
                                        <mn>1</mn>
                                        <mi>n</mi>
                                    </mfrac>
                                </mstyle>
                            </mrow>
                            <annotation encoding="application/x-tex">\displaystyle \frac{1}{n}</annotation>
                        </semantics>
                    </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut"
                            style="height:2.00744em;vertical-align:-0.686em;"></span><span class="mord"><span
                                class="mopen nulldelimiter"></span><span class="mfrac"><span
                                    class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                            style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord mathnormal">n</span></span></span><span
                                                style="top:-3.23em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="frac-line"
                                                    style="border-bottom-width:0.04em;"></span></span><span
                                                style="top:-3.677em;"><span class="pstrut"
                                                    style="height:3em;"></span><span class="mord"><span
                                                        class="mord">1</span></span></span></span><span
                                            class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"
                                            style="height:0.686em;"><span></span></span></span></span></span><span
                                class="mclose nulldelimiter"></span></span></span></span></span></eq> of being included
        in the final <strong>reservoir</strong>.</p>
    <blockquote dir="auto">
        <p dir="auto">Base Case</p>
        <blockquote dir="auto">
            <p dir="auto">At the iteration, we have processed n = 1 <strong>sample</strong>, each
                <strong>sample</strong> has equal probability <eq><span class="katex"><span class="katex-mathml"><math
                                xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                    <mrow>
                                        <mstyle scriptlevel="0" displaystyle="true">
                                            <mfrac>
                                                <mn>1</mn>
                                                <mn>1</mn>
                                            </mfrac>
                                            <mo>=</mo>
                                            <mn>1</mn>
                                        </mstyle>
                                    </mrow>
                                    <annotation encoding="application/x-tex">\displaystyle \frac{1}{1} = 1</annotation>
                                </semantics>
                            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span
                                    class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span
                                    class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                    style="height:1.32144em;"><span style="top:-2.314em;"><span
                                                            class="pstrut" style="height:3em;"></span><span
                                                            class="mord"><span class="mord">1</span></span></span><span
                                                        style="top:-3.23em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="frac-line"
                                                            style="border-bottom-width:0.04em;"></span></span><span
                                                        style="top:-3.677em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="mord"><span
                                                                class="mord">1</span></span></span></span><span
                                                    class="vlist-s">​</span></span><span class="vlist-r"><span
                                                    class="vlist"
                                                    style="height:0.686em;"><span></span></span></span></span></span><span
                                        class="mclose nulldelimiter"></span></span><span class="mspace"
                                    style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span
                                    class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span
                                class="base"><span class="strut"
                                    style="height:0.64444em;vertical-align:0em;"></span><span
                                    class="mord">1</span></span></span></span></eq> of being included in the final
                <strong>reservoir</strong>.
            </p>
        </blockquote>
        <p dir="auto">Inductive Step</p>
        <blockquote dir="auto">
            <p dir="auto">We assume that at the iteration, when we have processed n = k <strong>samples</strong>, each
                <strong>sample</strong> from the <strong>stream</strong> has an equal probability <eq><span
                        class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                    <mrow>
                                        <mstyle scriptlevel="0" displaystyle="true">
                                            <mfrac>
                                                <mn>1</mn>
                                                <mi>k</mi>
                                            </mfrac>
                                        </mstyle>
                                    </mrow>
                                    <annotation encoding="application/x-tex">\displaystyle \frac{1}{k}</annotation>
                                </semantics>
                            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span
                                    class="strut" style="height:2.00744em;vertical-align:-0.686em;"></span><span
                                    class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                    style="height:1.32144em;"><span style="top:-2.314em;"><span
                                                            class="pstrut" style="height:3em;"></span><span
                                                            class="mord"><span class="mord mathnormal"
                                                                style="margin-right:0.03148em;">k</span></span></span><span
                                                        style="top:-3.23em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="frac-line"
                                                            style="border-bottom-width:0.04em;"></span></span><span
                                                        style="top:-3.677em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="mord"><span
                                                                class="mord">1</span></span></span></span><span
                                                    class="vlist-s">​</span></span><span class="vlist-r"><span
                                                    class="vlist"
                                                    style="height:0.686em;"><span></span></span></span></span></span><span
                                        class="mclose nulldelimiter"></span></span></span></span></span></eq> of being
                included in the final <strong>reservoir</strong>.<br>
                And we would like to prove that at the iteration, when we have processed n = k + 1
                <strong>samples</strong>, each <strong>sample</strong> from the <strong>stream</strong> has an equal
                probability <eq><span class="katex"><span class="katex-mathml"><math
                                xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                    <mrow>
                                        <mstyle scriptlevel="0" displaystyle="true">
                                            <mfrac>
                                                <mn>1</mn>
                                                <mrow>
                                                    <mi>k</mi>
                                                    <mo>+</mo>
                                                    <mn>1</mn>
                                                </mrow>
                                            </mfrac>
                                        </mstyle>
                                    </mrow>
                                    <annotation encoding="application/x-tex">\displaystyle \frac{1}{k + 1}</annotation>
                                </semantics>
                            </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span
                                    class="strut"
                                    style="height:2.09077em;vertical-align:-0.7693300000000001em;"></span><span
                                    class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span
                                            class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"
                                                    style="height:1.32144em;"><span style="top:-2.314em;"><span
                                                            class="pstrut" style="height:3em;"></span><span
                                                            class="mord"><span class="mord mathnormal"
                                                                style="margin-right:0.03148em;">k</span><span
                                                                class="mspace"
                                                                style="margin-right:0.2222222222222222em;"></span><span
                                                                class="mbin">+</span><span class="mspace"
                                                                style="margin-right:0.2222222222222222em;"></span><span
                                                                class="mord">1</span></span></span><span
                                                        style="top:-3.23em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="frac-line"
                                                            style="border-bottom-width:0.04em;"></span></span><span
                                                        style="top:-3.677em;"><span class="pstrut"
                                                            style="height:3em;"></span><span class="mord"><span
                                                                class="mord">1</span></span></span></span><span
                                                    class="vlist-s">​</span></span><span class="vlist-r"><span
                                                    class="vlist"
                                                    style="height:0.7693300000000001em;"><span></span></span></span></span></span><span
                                        class="mclose nulldelimiter"></span></span></span></span></span></eq> of being
                included in the final <strong>reservoir</strong>.
            </p>
        </blockquote>
    </blockquote>
    <h2 dir="auto" id="references">References</h2>
    <p dir="auto">[Wyman 2023] <a href="https://intro-to-restir.cwyman.org/">Chris Wyman, Markus Kettunen, Daqi Lin,
            Benedikt Bitterli, Cem Yuksel, Wojciech Jarosz, Pawel Kozlowski, Giovanni Francesco. &quot;A Gentle
            Introduction to ReSTIR: Path Reuse in Real-time.&quot; SIGGRAPH 2023.</a></p>

</body>

</html>